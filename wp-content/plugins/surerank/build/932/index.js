"use strict";(globalThis.webpackChunksurerank=globalThis.webpackChunksurerank||[]).push([[932],{95932:(e,t,s)=>{s.r(t),s.d(t,{LazyRoute:()=>X,default:()=>L});var a=s(51609),n=s(86087),l=s(20019),o=s(27723),i=s(6903),c=s(88029),r=s(99019),m=s(45350),d=s(47579),u=s(47143),p=s(27165),h=s(71087),f=s(97213),g=s(28177),b=s(98583),y=s(94879);const E=({schema:e,type:t,handleFieldUpdate:s,schemaId:l})=>{const{setMetaSetting:o}=(0,u.useDispatch)(p.E),[i,c]=(0,n.useState)(t),{metaSettingsObject:r}=(0,u.useSuspenseSelect)((e=>{const{getMetaSettings:t}=e(p.E);return{metaSettingsObject:t()||{schemas:{}}}}),[]),m={schemas:r.schemas||{}},d=surerank_admin_common?.schema_type_data||{},[E,_]=(0,n.useState)([]),x=e=>e.reduce(((e,t)=>(e[t.id]="Group"===t.type&&t.fields?x(t.fields):void 0!==t.std?t.std:"",e)),{});(0,n.useEffect)((()=>{if(d[e]){const s=m.schemas[l]||{},a=s.fields||{},n={...x(d[e]),...a};1===Object.keys(a).length&&o("schemas",{...m.schemas,[l]:{...s,type:t,title:e,fields:n,show_on:s.show_on||{rules:[],specific:[],specificText:[]}}})}}),[e,l,d,m.schemas,o,t]),(0,n.useEffect)((()=>{if(d[e]){const t=(m.schemas[l]||{}).fields||{},s=(d[e]||[]).filter((e=>void 0!==t[e.id]||e.required));_(s)}}),[e,l,d,m.schemas]);const v=(e,t=null)=>t?m.schemas[l]?.fields?.[t]?.[e]||"":m.schemas[l]?.fields?.[e]||"",w=(t,a,n=null)=>{s(t,a);const i=m.schemas[l]||{},r=i.fields||{},u={...r};if(n){const s=d[e].find((e=>e.id===n))?.fields||[],l="@type"===t?a:v("@type",n),o=s.reduce(((e,t)=>(t.main&&t.main!==l||(e[t.id]=r[n]?.[t.id]||t.std||""),e)),{});o[t]=a,u[n]=o}else u[t]=a;o("schemas",{...m.schemas,[l]:{...i,fields:u}}),"@type"===t&&c(a)},S=E.filter((e=>"Hidden"===e.type||e.hidden)),k=E.filter((e=>!S.includes(e)));if(0===k.length)return b.E;const N=Object.entries(surerank_admin_common?.schema_variables||{}).map((([e,t])=>({value:e,label:t})));return(0,a.createElement)("div",{className:"space-y-4 w-full"},k.map((e=>e.required||e.show?(0,a.createElement)("div",{key:e.id,className:"space-y-1.5 p-2 w-full"},(0,a.createElement)("div",{className:"flex items-center justify-start gap-1.5 w-full"},(0,a.createElement)(h.A,{tag:"span",size:"sm",className:"space-x-0.5",required:e.required},(0,a.createElement)("span",null,e.label)),e.tooltip&&(0,a.createElement)(y.$w,{content:e.tooltip,placement:"top",arrow:!0,className:"z-[99999]"},(0,a.createElement)(f.A,{className:"size-4 text-icon-secondary",title:e.tooltip}))),(e=>"Group"===e.type?(0,a.createElement)(g.$4,{field:e,schemaType:i,getFieldValue:v,onFieldChange:w,variableSuggestions:N}):(0,a.createElement)("div",{className:"flex items-center justify-start gap-1.5 w-full"},e.cloneable?(0,g.OH)({field:e,schemaType:i,getFieldValue:v,onFieldChange:w,variableSuggestions:N,renderAsGroupComponent:!0}):(0,g.Yi)({field:e,schemaType:i,getFieldValue:v,onFieldChange:w,variableSuggestions:N,renderAsGroupComponent:!0})))(e),(0,g.FQ)(e)):null)))};var _=s(80697),x=s(1455),v=s.n(x),w=s(41521),S=s(1839),k=s(8921);const N=(0,n.memo)((({conditionsList:e,setConditionsList:t,groupedOptions:s,viewKey:l,updateSchema:i,fetchSpecificPosts:r})=>{const m=(0,n.useMemo)((()=>s.flatMap((e=>e.options))),[s]);return e.map(((n,d)=>{var u;return(0,a.createElement)("div",{key:d,className:"flex flex-col gap-2 mt-2"},(0,a.createElement)("div",{className:"flex flex-row gap-2 items-center"},(0,a.createElement)("div",{className:"w-full"},(0,a.createElement)(w.Ay,{combobox:!0,onChange:s=>{const a=[...e];a[d].condition=s,t(a),i(l,a.map((e=>e.condition)),a.filter((e=>"specifics"===e.condition)).flatMap((e=>e.specificPosts)))},size:"md",value:null!==(u=n.condition)&&void 0!==u?u:""},(0,a.createElement)(w.Ay.Button,{placeholder:(0,o.__)("Select an option","surerank"),render:e=>{if(e){const t=m.find((t=>t.value===e));return t?t.label:(0,o.__)("Select an option","surerank")}}}),(0,a.createElement)(w.Ay.Portal,{id:"surerank-root"},(0,a.createElement)(w.Ay.Options,null,s.map((e=>(0,a.createElement)(w.Ay.OptionGroup,{key:e.label,label:e.label},e.options.map((e=>(0,a.createElement)(w.Ay.Option,{key:e.value,value:e.value,name:e.label,id:e.value},e.label)))))))))),1!==e.length&&(0,a.createElement)(c.A,{variant:"ghost",size:"sm",onClick:()=>{const s=e.filter(((e,t)=>t!==d));t(s),i(l,s.map((e=>e.condition)),s.filter((e=>"specifics"===e.condition)).flatMap((e=>e.specificPosts)))},className:"text-icon-secondary",icon:(0,a.createElement)(S.A,{className:"size-4"})})),"specifics"===n.condition&&(0,a.createElement)(k.Ay,{isMulti:!0,options:n.searchOptions,value:n.specificPosts,onInputChange:e=>{e.length>2&&r(e,d,l)},onChange:s=>{const a=[...e];a[d].specificPosts=s,t(a),i(l,a.map((e=>e.condition)),a.filter((e=>"specifics"===e.condition)).flatMap((e=>e.specificPosts)))},placeholder:(0,o.__)("Search posts/pages/taxonomies, etc","surerank"),classNamePrefix:"surerank",classNames:{control:()=>"border border-solid border-field-border rounded-md outline outline-1 outline-field-border focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-focus focus-within:outline-none hover:border-field-border focus:border-field-border [&:hover:not(:focus):not(:focus-within)]:border-border-strong transition-[outline,border,background-color,color,box-shadow] duration-200 ease-in-out",multiValue:()=>"font-medium items-center justify-center border border-solid box-border max-w-full transition-colors duration-150 ease-in-out py-1 px-1.5 text-xs h-6 rounded gap-0.5 bg-badge-background-gray text-badge-color-gray border-badge-border-gray hover:bg-badge-hover-gray",multiValueLabel:()=>"font-medium text-xs",multiValueRemove:()=>"font-medium text-xs bg-transparent text-icon-secondary cursor-pointer",menu:()=>"outline outline-1 outline-field-border rounded-md z-10",noOptionsMessage:()=>"text-field-placeholder text-sm font-normal",placeholder:()=>"text-field-placeholder text-sm font-normal"},styles:{option:(e,t)=>({...e,backgroundColor:t.isFocused?"#f9fafb":"transparent",padding:"8px 12px"})}}))}))}));var A=s(62220);const C=({schemaId:e})=>{const{setMetaSetting:t}=(0,u.useDispatch)(p.E),{metaSettings:s}=(0,u.useSuspenseSelect)((e=>{const{getMetaSettings:t}=e(p.E);return{metaSettings:t()}}),[]),l=surerank_admin_common?.schema_rules||{},i=s.schemas?.[e]||{},r=(0,n.useMemo)((()=>Object.entries(l).map((([e,t])=>({label:t.label,options:Object.entries(t.value).map((([t,s])=>({value:t,label:s,key:e})))})))),[l]),m=i.show_on?.rules?.length?Array.from(new Set(i.show_on?.rules)).map((e=>({condition:e,specificPosts:"specifics"===e&&i?.show_on?.specificText||[],searchOptions:[]}))):[{condition:"",specificPosts:[],searchOptions:[]}],d=i.not_show_on?.rules?.length?Array.from(new Set(i.not_show_on?.rules)).map((e=>({condition:e,specificPosts:"specifics"===e&&i?.not_show_on?.specificText||[],searchOptions:[]}))):[{condition:"",specificPosts:[],searchOptions:[]}],[f,g]=(0,n.useState)({show_on:m,not_show_on:d}),b=(e,t)=>{g((s=>({...s,[e]:t})))},y=(0,n.useCallback)((async(e,t,s)=>{try{const a=await v()({path:A.CS,method:"POST",data:{q:e}});if(a?.success&&Array.isArray(a?.results)){const e=a.results.map((e=>({label:e.text,options:e.children.map((e=>({value:e.id,label:e.text})))})));g((a=>{const n=[...a[s]];return n[t].searchOptions=e,{...a,[s]:n}}))}}catch(a){}}),[]),E=(0,n.useCallback)(((a,n,l=null)=>{const o=Array.from(new Set(l?.map((e=>e.value)))),c=l?.filter((e=>o.includes(e.value)))||[],r={...i,[a]:{rules:n,specific:o,specificText:c}};t("schemas",{...s.schemas,[e]:r})}),[i,e,s.schemas,t]),x=e=>{g((t=>{const s=[...t[e]];return s.push({condition:"",specificPosts:[],searchOptions:[]}),E(e,s.map((e=>e.condition)),s.filter((e=>"specifics"===e.condition)).flatMap((e=>e.specificPosts))),{...t,[e]:s}}))};return(0,a.createElement)(a.Fragment,null,(0,a.createElement)("div",{className:"space-y-2 p-2"},(0,a.createElement)(h.A,{required:!0},(0,o.__)("Display On","surerank")),(0,a.createElement)(N,{conditionsList:f.show_on,setConditionsList:e=>b("show_on",e),groupedOptions:r,viewKey:"show_on",updateSchema:E,fetchSpecificPosts:y}),(0,a.createElement)(c.A,{variant:"ghost",size:"xs",onClick:()=>x("show_on"),className:"flex items-center gap-1",icon:(0,a.createElement)(_.A,{className:"size-4"})},(0,o.__)("Add Condition","surerank"))),(0,a.createElement)("div",{className:"space-y-2 p-2"},(0,a.createElement)(h.A,null,(0,o.__)("Do Not Display On","surerank")),(0,a.createElement)(N,{conditionsList:f.not_show_on,setConditionsList:e=>b("not_show_on",e),groupedOptions:r,viewKey:"not_show_on",updateSchema:E,fetchSpecificPosts:y}),(0,a.createElement)(c.A,{variant:"ghost",size:"xs",onClick:()=>x("not_show_on"),className:"flex items-center gap-1",icon:(0,a.createElement)(_.A,{className:"size-4"})},(0,o.__)("Add Condition","surerank"))))};var O=s(54429),M=s(22343),P=s(90232),I=s(87096);const z=(0,n.memo)((({schema:e,type:t,onBack:s,setMetaSetting:i,schemaId:r,metaSettings:d})=>{const[u,p]=(0,n.useState)("properties"),h=(e,t)=>{const s={...d.schemas[r],fields:{...d.schemas[r]?.fields,[e]:t}},a={...d.schemas,[r]:s};i("schemas",a)},f=(0,n.useCallback)((()=>{switch(u){case"properties":return(0,a.createElement)(E,{settings:d,schema:e,type:t||e,handleFieldUpdate:h,schemaId:r});case"display-conditions":return(0,a.createElement)(C,{settings:d,handleFieldUpdate:h,schemaId:r,schemaType:t});default:return null}}),[u,d]),g=(0,n.useCallback)((({value:e})=>{p(e.slug)}),[]);return(0,a.createElement)(l.A,{title:e,secondaryButton:(0,a.createElement)((()=>(0,a.createElement)(c.A,{onClick:s,variant:"outline",icon:(0,a.createElement)(P.A,{className:"size-4"}),iconPosition:"left"},(0,o.__)("Back","surerank"))),null)},(0,a.createElement)("div",{className:"flex flex-col items-start p-4 gap-2 bg-white shadow-sm rounded-[12px] order-1 flex-none flex-grow-0"},(0,a.createElement)(m.mc,{direction:"column",className:"w-full"},(0,a.createElement)(m.mc.Item,{className:"md:w-full lg:w-full p-2 pt-0"},(0,a.createElement)(O.Ay.Group,{activeItem:u,variant:"rounded",size:"sm",width:"full",onChange:g,className:"justify-around font-medium"},(0,a.createElement)(O.Ay.Tab,{className:"text-field-label max-w-none font-medium",slug:"properties",text:(0,o.__)("Properties","surerank")}),(0,a.createElement)(O.Ay.Tab,{className:"text-field-label max-w-none font-medium",slug:"display-conditions",text:(0,o.__)("Display Conditions","surerank")})))),(0,a.createElement)(M.P.div,{key:u,initial:{opacity:0,x:0},animate:{opacity:1,y:0},exit:{opacity:0,x:-10},transition:{duration:.3},className:"w-full"},f()),(0,a.createElement)(m.mc,{className:"py-2 px-0",gap:"sm"},(0,a.createElement)(I.j,null))))}));var T=s(98188),j=s(22895);const F=()=>{const{metaSettings:e}=(0,u.useSuspenseSelect)((e=>{const{getMetaSettings:t}=e(p.E);return{metaSettings:t()}}),[]),{setMetaSetting:t,invalidateResolutionForStoreSelector:s}=(0,u.useDispatch)(p.E),d=e?.schemas||{},h=Object.entries(d).map((([e,t])=>({id:e,...t}))),f=surerank_admin_common?.schema_type_options||{},g=surerank_admin_common?.default_schemas||{},y=Object.entries(g).map((([e,t])=>({id:e,...t}))),[E,_]=(0,n.useState)(!1),[x,v]=(0,n.useState)(!1),[w,k]=(0,n.useState)(""),[N,A]=(0,n.useState)(""),[C,O]=(0,n.useState)(""),[M,P]=(0,n.useState)(null);return(0,n.useEffect)((()=>{s("getMetaSettings",[])}),[]),x?(0,a.createElement)(z,{schema:w,type:N,onBack:()=>{v(!1)},setMetaSetting:t,schemaId:C,metaSettings:e}):(0,a.createElement)(l.A,{title:(0,o.__)("Schema","surerank"),description:(0,o.__)("Adds structured data to your content so search engines can better understand and present it. Most fields are already filled in to make setup easier and help your site show up better in search results.","surerank")},(0,a.createElement)("div",{className:"flex flex-col items-start p-4 gap-2 bg-white shadow-sm rounded-xl"},(0,a.createElement)(i.XI,{className:"w-full"},(0,a.createElement)(i.XI.Head,null,(0,a.createElement)(i.XI.HeadCell,null,(0,o.__)("Schema Title","surerank")),(0,a.createElement)(i.XI.HeadCell,null,(0,o.__)("Schema Type","surerank")),(0,a.createElement)(i.XI.HeadCell,{className:"w-14"},(0,a.createElement)("span",{className:"sr-only"},(0,o.__)("Actions","surerank")))),(0,a.createElement)(i.XI.Body,null,h.map((e=>(0,a.createElement)(i.XI.Row,{key:e.id},(0,a.createElement)(i.XI.Cell,{className:"p-3"},(0,a.createElement)("span",{className:"text-sm"},e?.fields?.schema_name||e?.title)),(0,a.createElement)(i.XI.Cell,{className:"p-3"},(0,a.createElement)("span",{className:"text-sm"},e?.fields?.["@type"]||e?.type)),(0,a.createElement)(i.XI.Cell,{className:"p-3 leading-none"},(0,a.createElement)("div",{className:"flex items-center justify-end gap-2"},(0,a.createElement)(c.A,{variant:"ghost",size:"xs",icon:(0,a.createElement)(T.A,{"aria-label":"icon",role:"img"}),className:"text-text-secondary hover:text-icon-primary",onClick:()=>(e=>{const t=d[e];O(e),k(t.title),A(t.type),v(!0)})(e.id)}),(0,a.createElement)(r.m,{open:M===e.id,setOpen:()=>P(e.id),variant:"light",placement:"bottom",tooltipPortalId:"surerank-root",className:"p-2 border border-solid border-border-subtle [&>svg>path]:stroke-border-subtle z-[99999]",interactive:!0,arrow:!0,content:(0,a.createElement)("div",{className:"space-x-2"},(0,a.createElement)(c.A,{size:"xs",variant:"ghost",className:"focus:[box-shadow:none]",onClick:()=>P(null)},(0,o.__)("Cancel","surerank")),(0,a.createElement)(c.A,{size:"xs",className:"focus:[box-shadow:none] bg-button-danger hover:bg-button-danger-hover outline-button-danger hover:outline-button-danger-hover",onClick:()=>(e=>{const s={...d};delete s[e],t("schemas",s),P(null)})(e.id)},(0,o.__)("Remove","surerank")))},(0,a.createElement)(c.A,{size:"xs",variant:"ghost",className:"p-0 text-text-secondary inline-flex rounded-sm focus:[box-shadow:none]",icon:(0,a.createElement)(S.A,null),onClick:()=>P(e.id)}))))))))),(0,a.createElement)(m.mc,{className:"py-2 px-0",gap:"sm"},(0,a.createElement)(I.j,null),(0,a.createElement)(j.A,{selectedSchema:w,setSelectedSchema:k,selectedType:N,setSelectedType:A,schemaTypeOptions:f,defaultSchemas:y,handleAddSchema:()=>{const e=(0,b.l)(),s={title:w||"",type:N||"",show_on:{rules:[],specific:[],specificText:[]},fields:{"@type":N||""}};t("schemas",{...d,[e]:s}),O(e),k(s.title),v(!0)},isModalOpen:E,closeModal:()=>_(!1)}))))},X=(0,s(46037).AF)("/advanced/schema")({component:(0,d.A)(F)}),L=(0,d.A)(F)}}]);